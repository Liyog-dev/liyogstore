<!doctype html>
<html lang="en" class="scroll-smooth"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Liyog - Shop Smart, Live Better</title> 
  <meta name="description" content="Unbeatable deals on top products, delivered fast. Experience the future of online shopping with Liyog."> 
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåø</text></svg>"> 
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"> 
  <script src="https://cdn.tailwindcss.com"></script> 
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            liyog: {
              light: '#34bf49',
              DEFAULT: '#28a428',
              dark: '#228b22',
              deep: '#006400',
            },
            accent: {
              DEFAULT: '#ff7a00',
              dark: '#e66e00',
            },
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          keyframes: {
            // Keyframe for the skeleton loader's shimmer effect
            shimmer: {
              '100%': { transform: 'translateX(100%)' },
            },
          },
        },
      },
      plugins: [
        // This line is for better default form styling, not strictly needed but good practice
        // In a real build, you'd install it via npm: `npm install -D @tailwindcss/forms`
      ],
    }
  </script> 
  <style>
    /* A little bit of custom CSS for the shimmer effect on skeletons */
    .shimmer::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        background-image: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0) 0,
            rgba(255, 255, 255, 0.2) 20%,
            rgba(255, 255, 255, 0.5) 60%,
            rgba(255, 255, 255, 0)
        );
        animation: shimmer 2s infinite;
    }
  </style> 
 </head> 
 <body class="bg-gray-100 text-gray-800 font-sans antialiased"> 
  <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50"> 
   <nav class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8"> 
    <div class="flex items-center justify-between h-16"> 
     <div class="flex-shrink-0"> <a href="#" class="text-3xl font-extrabold text-liyog flex items-center"> 
       <svg class="w-8 h-8 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8h6m-5 0a3 3 0 110 6H9l-2 2V6a2 2 0 012-2z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 110-6h-2l2 2V18a2 2 0 01-2 2z"></path> 
       </svg> Liyog </a> 
     </div> 
     <div class="hidden md:flex flex-1 items-center justify-center px-8 lg:px-16"> 
      <div class="w-full max-w-lg"> 
       <input type="search" placeholder="Search for products, brands, and categories..." class="w-full px-4 py-2 text-sm border border-gray-300 rounded-full bg-gray-50 focus:ring-2 focus:ring-liyog-light focus:border-liyog-light transition-all duration-300"> 
      </div> 
     </div> 
     <div class="flex items-center gap-4 sm:gap-6"> <button class="hidden sm:inline-flex items-center gap-2 text-sm font-medium hover:text-liyog transition-colors"> 
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path> 
       </svg> Account </button> <button class="relative text-gray-600 hover:text-liyog transition-colors"> 
       <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path> 
       </svg> <span class="absolute -top-1 -right-2 bg-accent text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full">3</span> </button> <button id="menu-toggle" class="md:hidden text-gray-600 hover:text-liyog"> 
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path> 
       </svg> </button> 
     </div> 
    </div> 
   </nav> 
   <div id="mobile-menu" class="hidden md:hidden px-4 pt-2 pb-4 space-y-2 border-t"> 
    <input type="search" placeholder="Search..." class="w-full px-4 py-2 text-sm border rounded-full bg-gray-50"> <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-liyog">Account</a> <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-liyog">Help</a> 
   </div> 
  </header> 
  <main class="max-w-screen-xl mx-auto py-8 sm:py-12 px-4 sm:px-6 lg:px-8"> 
   <div class="flex flex-col lg:flex-row gap-8"> 
    <aside class="w-full lg:w-1/4 xl:w-1/5"> 
     <div class="bg-white p-4 rounded-lg shadow-sm"> 
      <h3 class="text-lg font-bold border-b pb-2 mb-4">Categories</h3> 
      <ul class="space-y-2 text-sm"> 
       <li><a href="#" class="flex justify-between items-center p-2 rounded-md hover:bg-liyog hover:text-white transition-all"><span>Electronics</span><span class="text-xs bg-gray-200 px-2 py-0.5 rounded-full">12k+</span></a></li> 
       <li><a href="#" class="flex justify-between items-center p-2 rounded-md hover:bg-liyog hover:text-white transition-all"><span>Fashion</span><span class="text-xs bg-gray-200 px-2 py-0.5 rounded-full">8k+</span></a></li> 
       <li><a href="#" class="flex justify-between items-center p-2 rounded-md hover:bg-liyog hover:text-white transition-all"><span>Groceries</span><span class="text-xs bg-gray-200 px-2 py-0.5 rounded-full">22k+</span></a></li> 
       <li><a href="#" class="flex justify-between items-center p-2 rounded-md hover:bg-liyog hover:text-white transition-all"><span>Home &amp; Office</span><span class="text-xs bg-gray-200 px-2 py-0.5 rounded-full">15k+</span></a></li> 
       <li><a href="#" class="flex justify-between items-center p-2 rounded-md hover:bg-liyog hover:text-white transition-all"><span>Health &amp; Beauty</span><span class="text-xs bg-gray-200 px-2 py-0.5 rounded-full">9k+</span></a></li> 
      </ul> 
     </div> 
    </aside> 
    <section class="flex-1"> 
     <h2 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-6">Featured Products</h2> 
     <div id="products-grid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6"> 
     </div> 
     <div id="error-container" class="hidden mt-6"></div> 
    </section> 
   </div> 
  </main> 
  <footer class="bg-gray-800 text-white mt-16"> 
   <div class="max-w-screen-xl mx-auto py-12 px-4 sm:px-6 lg:px-8"> 
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8"> 
     <div> 
      <h4 class="font-bold text-lg mb-4">Liyog</h4> 
      <p class="text-sm text-gray-400">Shop Smart. Live Better.</p> 
     </div> 
     <div> 
      <h4 class="font-bold mb-4">Quick Links</h4> 
      <ul class="space-y-2 text-sm text-gray-300"> 
       <li><a href="#" class="hover:text-liyog-light">Home</a></li> 
       <li><a href="#" class="hover:text-liyog-light">About Us</a></li> 
       <li><a href="#" class="hover:text-liyog-light">Contact</a></li> 
      </ul> 
     </div> 
     <div> 
      <h4 class="font-bold mb-4">Help</h4> 
      <ul class="space-y-2 text-sm text-gray-300"> 
       <li><a href="#" class="hover:text-liyog-light">FAQ</a></li> 
       <li><a href="#" class="hover:text-liyog-light">Shipping</a></li> 
       <li><a href="#" class="hover:text-liyog-light">Returns</a></li> 
      </ul> 
     </div> 
     <div> 
      <h4 class="font-bold mb-4">Follow Us</h4> 
     </div> 
    </div> 
    <div class="mt-8 border-t border-gray-700 pt-6 text-center text-sm text-gray-400">
      ¬© <span id="year"></span> Liyog. All Rights Reserved. Built with ‚ù§Ô∏è in Onitsha. 
    </div> 
   </div> 
  </footer> 
  <script type="module">
    // This single script contains the logic from 4 separate files.
    // When you're ready for production, you should split them as commented.

    // ===================================================================
    // START: Code for `src/js/config.js`
    // ===================================================================
    const SUPABASE_URL = "https://snwwlewjriuqrodpjhry.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNud3dsZXdqcml1cXJvZHBqaHJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2MDY3MDAsImV4cCI6MjA2ODE4MjcwMH0.WxOmEHxLcEHmMKFjsgrzcb22mPs-sJwW_G3GOuXX2c8";
    // ===================================================================
    // END: Code for `src/js/config.js`
    // ===================================================================


    // ===================================================================
    // START: Code for `src/js/api.js`
    // ===================================================================
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

    /**
     * Fetches published products from the database with all required fields.
     * @returns {Promise<{data: any[] | null, error: any | null}>}
     */
    async function fetchProducts() {
      try {
        const { data, error } = await supabaseClient
          .from("products")
          .select(`
            id, name, price, discount_percent, discount_price, image_urls,
            published, avg_rating, total_reviews, total_orders,
            total_likes, liyogx_coins, total_views, slug
          `) // <--- Added 'slug' here
          // We fetch all products, and the UI will handle the "published" state
          .order("created_at", { ascending: false })
          .limit(20);

        if (error) {
          throw error;
        }
        return { data, error: null };
      } catch (error) {
        console.error("Error fetching products:", error.message);
        return { data: null, error };
      }
    }
    // ===================================================================
    // END: Code for `src/js/api.js`
    // ===================================================================


    // ===================================================================
    // START: Code for `src/js/ui.js`
    // ===================================================================
    const productsGrid = document.getElementById("products-grid");
    const errorContainer = document.getElementById("error-container");

    /**
     * Generates SVG stars for product rating.
     * @param {number} rating - The average rating (e.g., 4.5).
     * @returns {string} HTML string of SVG stars.
     */
    function generateStarRatingHTML(rating = 0) {
        const totalStars = 5;
        let starsHTML = '';
        const starId = `star-grad-${Math.random().toString(36).substr(2, 9)}`;

        for (let i = 1; i <= totalStars; i++) {
            const fillPercentage = i <= rating ? 100 : (i - rating < 1 ? (rating - Math.floor(rating)) * 100 : 0);
            
            starsHTML += `
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="url(#${starId})" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="${starId}">
                            <stop offset="${fillPercentage}%" stop-color="#ffd700" />
                            <stop offset="${fillPercentage}%" stop-color="#e5e7eb" />
                        </linearGradient>
                    </defs>
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"/>
                </svg>
            `;
        }
        return `<div class="flex items-center">${starsHTML}</div>`;
    }

    /**
     * Renders a single, professionally designed product card.
     * @param {object} product The product data from Supabase.
     * @returns {string} The HTML string for the product card.
     */
    function createProductCardHTML(product) {
        // --- Data Preparation ---
        const imageUrl = (product.image_urls && product.image_urls.length > 0)
            ? product.image_urls[0]
            : "https://via.placeholder.com/400?text=Liyog";

        const isPublished = product.published;
        const outOfStockClass = !isPublished ? 'opacity-60 grayscale' : '';
        const outOfStockPointer = !isPublished ? 'pointer-events-none' : '';

        // --- Price Calculation ---
        let finalPrice = product.price;
        let originalPrice = product.price;
        let discountPercentage = product.discount_percent || 0;
        let hasDiscount = false;

        if (product.discount_price != null && product.discount_price < product.price) {
            finalPrice = product.discount_price;
            discountPercentage = Math.round(((product.price - product.discount_price) / product.price) * 100);
            hasDiscount = true;
        } else if (product.discount_percent > 0) {
            finalPrice = product.price * (1 - product.discount_percent / 100);
            hasDiscount = true;
        }

        // --- FIX: Construct the product URL using the slug ---
        const productUrl = `product.html?slug=${product.slug}`;

        // --- HTML Components ---
        const discountBadge = hasDiscount
            ? `<div class="absolute top-2 left-2 bg-gradient-to-r from-accent to-[#ffd700] text-white text-[11px] font-bold px-2 py-0.5 rounded-full shadow-md">-${discountPercentage}%</div>`
            : "";

        const stockBadge = isPublished
            ? `<div class="text-xs font-bold text-green-600">In Stock</div>`
            : `<div class="text-xs font-bold text-red-600">Out of Stock</div>`;

        const outOfStockOverlay = !isPublished
            ? `<div class="absolute inset-0 bg-white/50 flex items-center justify-center"><span class="text-lg font-bold text-gray-700 bg-white/80 px-4 py-2 rounded-lg">Out of Stock</span></div>`
            : "";
        
        const likesAndViews = `
            <div class="absolute top-2 right-2 flex flex-col items-end gap-1 text-white text-xs">
                <div class="bg-black/40 backdrop-blur-sm px-2 py-0.5 rounded-full flex items-center gap-1">
                    <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                    <span>${product.total_likes || 0}</span>
                </div>
                <div class="bg-black/40 backdrop-blur-sm px-2 py-0.5 rounded-full flex items-center gap-1">
                    <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path><path fill-rule="evenodd" d="M.458 10C3.732 4.143 10 4.143 16.268 10c-3.273 5.857-9.536 5.857-12.81 0zM10 14a4 4 0 100-8 4 4 0 000 8z" clip-rule="evenodd"></path></svg>
                    <span>${product.total_views || 0}</span>
                </div>
            </div>`;
        
        return `
            <div class="bg-white rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 group overflow-hidden flex flex-col border border-gray-200/80 ${outOfStockClass}" data-published="${isPublished}">
                <a href="${productUrl}" class="block relative overflow-hidden ${outOfStockPointer}">
                    <div class="aspect-square w-full">
                        <img src="${imageUrl}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" loading="lazy" />
                    </div>
                    ${discountBadge}
                    ${likesAndViews}
                    ${outOfStockOverlay}
                </a>

                <div class="p-3 sm:p-4 flex flex-col flex-grow">
                    <div class="flex justify-between items-center mb-2">
                        ${stockBadge}
                    </div>

                    <h3 class="text-sm font-semibold text-gray-800 line-clamp-2 flex-grow mb-2">
                        <a href="${productUrl}" class="hover:text-liyog-dark transition-colors">${product.name}</a>
                    </h3>

                    <div class="flex items-center gap-2 text-xs text-gray-500 mb-3">
                        ${generateStarRatingHTML(product.avg_rating)}
                        <span class="font-bold text-gray-700">${(product.avg_rating || 0).toFixed(1)}</span>
                        <span>(${(product.total_reviews || 0).toLocaleString()})</span>
                    </div>

                    <div class="mb-3">
                        <span class="text-xl font-extrabold text-liyog-dark">‚Ç¶${finalPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                        ${hasDiscount ? `<span class="text-sm line-through text-gray-400 ml-2">‚Ç¶${originalPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>` : ''}
                    </div>
                    
                    <div class="border-t border-gray-100 pt-3 mt-auto space-y-2 text-xs">
                        <div class="flex justify-between items-center text-gray-600">
                           <span><strong class="font-semibold text-gray-800">${(product.total_orders || 0).toLocaleString()}</strong> sold</span>
                           <span class="flex items-center gap-1 font-semibold text-amber-600">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM6.343 6.343a.5.5 0 01.707 0L10 9.293l2.95-2.95a.5.5 0 11.707.707L10.707 10l2.95 2.95a.5.5 0 01-.707.707L10 10.707l-2.95 2.95a.5.5 0 01-.707-.707L9.293 10 6.343 7.05a.5.5 0 010-.707z"></path></svg>
                                Earn <strong class="text-base">${product.liyogx_coins || 0}</strong> LXC
                           </span>
                        </div>
                    </div>
                </div>
                
                <div class="px-2 pb-2 mt-1 ${outOfStockPointer}">
                    <div class="flex flex-col rounded-lg overflow-hidden shadow-inner font-bold text-sm text-center">
                        <button class="w-full px-3 py-2.5 bg-liyog text-white hover:bg-liyog-dark transition-colors duration-300">
                            Add to Cart
                        </button>
                        <div class="h-0.5 bg-white/50"></div>
                        <button class="w-full px-3 py-2.5 bg-accent text-white hover:bg-accent-dark transition-colors duration-300">
                            Order Now
                        </button>
                    </div>
                </div>
            </div>
        `;
    }


    /**
     * Renders a skeleton loader card.
     * @returns {string} The HTML string for the skeleton card.
     */
    function createSkeletonCardHTML() {
      return `
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200/80">
            <div class="relative">
                <div class="aspect-square w-full bg-gray-200 shimmer"></div>
            </div>
            <div class="p-4">
                <div class="h-3 bg-gray-200 rounded w-1/4 mb-3 shimmer"></div>
                <div class="h-4 bg-gray-200 rounded w-full mb-2 shimmer"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-4 shimmer"></div>
                <div class="flex items-center gap-2 mb-4">
                    <div class="h-4 w-20 bg-gray-200 rounded shimmer"></div>
                    <div class="h-4 w-12 bg-gray-200 rounded shimmer"></div>
                </div>
                <div class="h-8 bg-gray-300 rounded w-1/2 mb-4 shimmer"></div>
                <div class="h-10 bg-gray-300 rounded-lg w-full shimmer"></div>
            </div>
        </div>
      `;
    }

    /**
     * Renders the products to the grid.
     * @param {Array<object>} products - Array of product objects.
     */
    function renderProducts(products) {
      if (!productsGrid) return;
      productsGrid.innerHTML = products.map(createProductCardHTML).join("");
    }

    /**
     * Renders skeleton loaders to the grid.
     * @param {number} count - The number of skeletons to display.
     */
    function renderSkeletons(count) {
      if (!productsGrid) return;
      const skeletonsHTML = Array(count).fill(0).map(createSkeletonCardHTML).join("");
      productsGrid.innerHTML = skeletonsHTML;
    }

    /**
     * Displays an error message.
     * @param {string} message - The error message to display.
     */
    function displayError(message = "Oops! Something went wrong.") {
        if (!productsGrid || !errorContainer) return;
        productsGrid.innerHTML = "";
        errorContainer.classList.remove('hidden');
        errorContainer.innerHTML = `
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center" role="alert">
                <strong class="font-bold">Error:</strong>
                <span class="block sm:inline">${message} Please try again later.</span>
            </div>
        `;
    }
    // ===================================================================
    // END: Code for `src/js/ui.js`
    // ===================================================================


    // ===================================================================
    // START: Code for `src/js/main.js` (The App Orchestrator)
    // ===================================================================
    (function App() {
      
      function init() {
        document.addEventListener("DOMContentLoaded", () => {
          setupEventListeners();
          loadInitialProducts();
          updateFooterYear();
        });
      }

      function setupEventListeners() {
        const menuToggle = document.getElementById("menu-toggle");
        const mobileMenu = document.getElementById("mobile-menu");

        if (menuToggle && mobileMenu) {
          menuToggle.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
          });
        }
      }

      async function loadInitialProducts() {
        renderSkeletons(12);
        const { data: products, error } = await fetchProducts();

        if (error) {
          displayError("Failed to connect to the store.");
          return;
        }

        if (!products || products.length === 0) {
          displayError("No products are available at the moment. Please check back soon!");
          return;
        }

        renderProducts(products);
      }

      function updateFooterYear() {
        const yearEl = document.getElementById("year");
        if (yearEl) {
          yearEl.textContent = new Date().getFullYear();
        }
      }

      init();

    })();
    // ===================================================================
    // END: Code for `src/js/main.js`
    // ===================================================================
</script> 
 </body>
</html>

